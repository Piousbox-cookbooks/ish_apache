
<VirtualHost *:<%= @listen_port %>>

  ServerAdmin piousbox@gmail.com

  ServerName <%= @server_name %>

  KeepAlive On
  ProxyVia On
  ProxyPreserveHost On
  
  <% if @server_names %>
    <% @server_names.each do |p| %>
  ServerAlias <%= p %>
    <% end %>
  <% end %>

  ProxyPreserveHost On
  ProxyVia On

  <proxy>
    Order deny,allow
    Allow from all
  </proxy>

  ProxyPass / http://<%= @cloud_ip -%>:<%= @cloud_port -%>/ connectiontimeout=15 timeout=45
  ProxyPassReverse / http://<%= @cloud_ip -%>:<%= @cloud_port -%>/

  <% # currently there is no automatic way to set that password. You have to ssh and do the password yourself. _vp_ 20130818 %>
  <Location / >
    AuthType Basic
    AuthName ".ht Intelligence"
    AuthUserFile /home/ubuntu/.htpasswd
    Require valid-user    
  </Location>


</VirtualHost>